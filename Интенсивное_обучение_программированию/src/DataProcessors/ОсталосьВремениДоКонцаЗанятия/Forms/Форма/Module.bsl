#Область ОписаниеПеременных

&НаКлиенте
Перем ДоОкончанияЧас;
&НаКлиенте
Перем ДоОкончанияМин; 
&НаКлиенте
Перем МоментНачалаРасчета;

#КонецОбласти


#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ВвестиДатуВремяОкончания();
	
КонецПроцедуры

#КонецОбласти


#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ВвестиДатуВремяОкончания()
	
	Оповещение = Новый ОписаниеОповещения("ПослеВводаДаты", ЭтотОбъект);
	ПоказатьВводДаты(Оповещение, , "Введите дату и время окончания урока", ЧастиДаты.ДатаВремя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеВводаДаты(ДатаВремяОкончания, Параметры) Экспорт

	МоментНачалаРасчета = ТекущаяДата();
	
	Если ДатаВремяОкончания = Неопределено Тогда
		
		Сообщение 		= Новый СообщениеПользователю();
		Сообщение.Текст = "Введена неверная дата";
		Сообщение.Сообщить();
		Возврат;
		
	ИначеЕсли ДатаВремяОкончания < МоментНачалаРасчета Тогда 
		
		Сообщение 		= Новый СообщениеПользователю();
		Сообщение.Текст = "Урок уже закончен";
		Сообщение.Сообщить();
		Возврат;
		
	КонецЕсли;
	
	Объект.ДатаВремяОкончания = ДатаВремяОкончания;
	РсчитатьВремяДоОкончания ();
	
КонецПроцедуры

&НаКлиенте
Процедура РсчитатьВремяДоОкончания () 
	
	Если Час(Объект.ДатаВремяОкончания) = Час(МоментНачалаРасчета) Тогда
		
		ДоОкончанияЧас = 0;
		ДоОкончанияМин = Минута(Объект.ДатаВремяОкончания) - Минута(МоментНачалаРасчета); 
		
	КонецЕсли;	
	
	Если Минута(Объект.ДатаВремяОкончания) < Минута(МоментНачалаРасчета) Тогда
		
		ДоОкончанияЧас = Час(Объект.ДатаВремяОкончания) - Час(МоментНачалаРасчета)-1; 
		ДоОкончанияМин = 60 - (Минута(МоментНачалаРасчета) - Минута(Объект.ДатаВремяОкончания)); 
	Иначе
		ДоОкончанияЧас = Час(Объект.ДатаВремяОкончания) - Час(МоментНачалаРасчета); 
		ДоОкончанияМин = Минута(Объект.ДатаВремяОкончания) - Минута(МоментНачалаРасчета); 
		
	КонецЕсли;
	
	Сообщение 		= Новый СообщениеПользователю();
	Сообщение.Текст = СтрШаблон("До конца занаятия %1 ч. %2 мин.", ДоОкончанияЧас, ДоОкончанияМин);
	Сообщение.Сообщить();
	
КонецПроцедуры

#КонецОбласти